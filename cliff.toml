[changelog]
header = ""
body = """
{%- macro render_group(name, commits) -%}
{%- set found = commits | filter(attribute="group", value=name) -%}
{%- if found | length > 0 %}
### {{ name }}
{% for commit in found -%}
- **{{ commit.scope | default(value="core") }}:** {{ commit.message | split(pat="\n") | first | trim }} ([`{{ commit.id | truncate(length=7, end="") }}`](https://github.com/automagik-dev/workit/commit/{{ commit.id }}))
{% endfor %}
{%- endif -%}
{%- endmacro -%}

{{ self::render_group(name="ğŸš€ Features", commits=commits) -}}
{{ self::render_group(name="ğŸ› Bug Fixes", commits=commits) -}}
{{ self::render_group(name="âš¡ Performance", commits=commits) -}}
{{ self::render_group(name="â™»ï¸ Refactoring", commits=commits) -}}
{{ self::render_group(name="ğŸ§ª Testing", commits=commits) -}}
{{ self::render_group(name="ğŸ“š Documentation", commits=commits) -}}
{{ self::render_group(name="âš™ï¸ CI/CD", commits=commits) -}}
{{ self::render_group(name="ğŸ”§ Miscellaneous", commits=commits) -}}

{%- set_global contributors = [] -%}
{%- for commit in commits -%}
  {%- set author = commit.author.name | default(value="") -%}
  {%- if author != "" and author != "github-actions[bot]" -%}
    {%- if contributors is not containing(author) -%}
      {%- set_global contributors = contributors | concat(with=author) -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{%- if contributors | length > 0 %}
### ğŸ‘¥ Contributors
{% for name in contributors -%}
{%- if name == "Cezar Vasconcelos" -%}
- [@vasconceloscezar](https://github.com/vasconceloscezar)
{% elif name == "Felipe Rosa" -%}
- [@namastex888](https://github.com/namastex888)
{% elif name == "Automagik Genie" -%}
- [@automagik-genie](https://github.com/automagik-genie) ğŸ¤–
{% else -%}
- {{ name }}
{% endif -%}
{%- endfor -%}
{%- endif -%}
"""
trim = true

[git]
conventional_commits = true
filter_unconventional = true
# Ignore intermediate version tags within the commit range to prevent
# duplicate section headers. The range boundaries are set by the workflow.
# Only ignore pre-release/rc tags; keep calver release tags for range detection
ignore_tags = ".*-(alpha|beta|rc).*"
sort_commits = "newest"

# Escape @ mentions in commit messages so GitHub doesn't linkify them as users
commit_preprocessors = [
  { pattern = "@([a-zA-Z])", replace = "@\u200B${1}" },
]

commit_parsers = [
  { message = "^feat", group = "ğŸš€ Features" },
  { message = "^fix", group = "ğŸ› Bug Fixes" },
  { message = "^refactor", group = "â™»ï¸ Refactoring" },
  { message = "^perf", group = "âš¡ Performance" },
  { message = "^test", group = "ğŸ§ª Testing" },
  { message = "^doc", group = "ğŸ“š Documentation" },
  { message = "^ci", group = "âš™ï¸ CI/CD" },
  { message = "^chore\\(version\\)", skip = true },
  { message = "^chore", group = "ğŸ”§ Miscellaneous" },
  { message = "^Merge", skip = true },
  { message = ".*", group = "ğŸ”§ Miscellaneous" },
]
